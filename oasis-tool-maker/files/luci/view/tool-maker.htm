<%+header%>

<link rel="stylesheet" type="text/css" href="<%= resource %>/oasis/css/tool-maker.css">

<div id="tool-maker-toast" class="tm-toast" role="status" aria-live="polite" aria-atomic="true"></div>

<h2><%:Tool Maker%></h2>

<div class="tm-wrap">
  <div class="tm-card">
    <div class="tm-row">
      <label for="tm-template"><%:Tool type%></label>
      <select id="tm-template">
        <option value="lua">Lua</option>
        <option value="ucode">uCode</option>
      </select>
    </div>
    <div class="tm-row">
      <label for="tm-name"><%:Server script name%></label>
      <input id="tm-name" type="text" placeholder="oasis.tool.example" />
    </div>
    <div class="tm-row">
      <label><%:Tools%></label>
      <div class="tm-tool-list">
        <div id="tm-tool-list"></div>
        <button type="button" id="tm-add-tool" class="tm-btn"><%:Add tool%></button>
      </div>
    </div>
    <div class="tm-row">
      <label for="tm-tool-name"><%:Tool name%></label>
      <input id="tm-tool-name" type="text" placeholder="get_weather" />
    </div>
    <div class="tm-row">
      <label for="tm-tool-desc"><%:Tool description%> *</label>
      <input id="tm-tool-desc" type="text" placeholder="<%:Get current temperature for a given location.%>" />
    </div>
    <div class="tm-row">
      <label><%:Tool arguments%></label>
      <div class="tm-arg-list">
        <div class="tm-arg-head">
          <span><%:Arg name%></span>
          <span><%:Type%></span>
          <span><%:Arg description%></span>
        </div>
        <div id="tm-arg-rows"></div>
        <button type="button" id="tm-add-arg" class="tm-btn"><%:Add arg%></button>
      </div>
    </div>
    <div class="tm-row">
      <label for="tm-body"><%:Call body (editable)%></label>
      <textarea id="tm-body" rows="12" spellcheck="false"></textarea>
    </div>
    <div class="tm-actions">
      <button type="button" id="tm-generate" class="tm-btn primary"><%:Generate%></button>
      <button type="button" id="tm-validate" class="tm-btn"><%:Validate%></button>
      <button type="button" id="tm-save" class="tm-btn"><%:Upload%></button>
    </div>
  </div>

  <div class="tm-card">
    <div class="tm-row">
      <label for="tm-output"><%:Generated output%></label>
      <textarea id="tm-output" rows="16" spellcheck="false" readonly></textarea>
    </div>
    <div id="tm-result" class="tm-result"></div>
  </div>
</div>

<script>
window.OasisToolMakerConfig = {
  urls: {
    render: '<%=build_url("admin", "network", "oasis", "tool-maker-render")%>',
    save: '<%=build_url("admin", "network", "oasis", "tool-maker-save")%>',
    validate: '<%=build_url("admin", "network", "oasis", "tool-maker-validate")%>',
    refreshTools: '<%=build_url("admin", "network", "oasis", "refresh-tools")%>'
  },
  strings: {
    defaultToolDescription: '<%:Get current temperature for a given location.%>',
    defaultArgDescription: '<%:City and country e.g. BogotÃ¡, Colombia%>',
    unnamedLabel: '<%:unnamed%>',
    unknownError: '<%:unknown error%>',
    generated: '<%:Generated%>',
    renderFailed: '<%:Render failed%>',
    renderFailedWithReason: '<%:Render failed: {error}%>',
    missingToolDescription: '<%:Missing tool description%>',
    validationOk: '<%:Validation OK%>',
    validationNg: '<%:Validation NG%>',
    validationNgWithReason: '<%:Validation NG: {error}%>',
    validateFailed: '<%:Validate failed%>',
    noResponse: '<%:No response%>',
    missingToolName: '<%:Missing tool name%>',
    missingToolDefinition: '<%:Missing tool definition%>',
    noContent: '<%:No content%>',
    saved: '<%:Saved%>',
    savedSummary: '<%:Saved: {path} ({bytes} bytes)%>',
    saveFailed: '<%:Save failed%>',
    saveFailedWithReason: '<%:Save failed: {error}%>',
    refreshFailed: '<%:Refresh failed%>',
    backendInvalidTools: '<%:invalid tools%>',
    backendFailedToRender: '<%:failed to render%>',
    backendInvalidBody: '<%:invalid body%>',
    backendEmptyTools: '<%:empty tools%>',
    backendMissingToolDescription: '<%:missing tool description%>',
    backendMissingToolName: '<%:missing tool name%>',
    backendMissingCallBody: '<%:missing call body%>',
    backendInvalidArgs: '<%:invalid args%>',
    backendArgsDescMismatch: '<%:args and args_desc mismatch%>',
    backendInvalidArg: '<%:invalid arg%>',
    backendInvalidTemplateType: '<%:invalid template type%>',
    backendTemplateNotFound: '<%:template not found%>',
    backendLuaLoaderNotAvailable: '<%:lua loader not available%>',
    backendUcodeSyntaxError: '<%:ucode syntax error%>',
    backendFailedToWriteTempFile: '<%:failed to write temp file%>',
    backendInvalidToolType: '<%:invalid tool type%>',
    backendMissingName: '<%:missing name%>',
    backendInvalidName: '<%:invalid name%>',
    backendEmptyContent: '<%:empty content%>',
    backendAlreadyExists: '<%:already exists%>',
    backendFailedToWriteFile: '<%:failed to write file%>',
    backendFailedToChmod: '<%:failed to chmod%>',
    backendFailedToSetExecutablePermission: '<%:failed to set executable permission%>',
    backendMarkerBeginNotFound: '<%:marker begin not found%>',
    backendMarkerBeginLineNotFound: '<%:marker begin line not found%>',
    backendMarkerEndNotFound: '<%:marker end not found%>',
    backendMarkerEndLineNotFound: '<%:marker end line not found%>'
  }
};
</script>
<script src="<%= resource %>/oasis/js/tool-maker.js"></script>

<%+footer%>
